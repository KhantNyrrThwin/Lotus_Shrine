# Lotus Shrine - Koe Na Win Tracker Setup Guide

This guide will help you set up the Koe Na Win tracker system to connect with another Lotus_Shrine folder running on `http://localhost/lotus_shrine/`.

## ğŸ“‹ Prerequisites

- PHP 7.4+ with MySQL/MariaDB
- Web server (Apache/Nginx) configured to serve PHP files
- MySQL/MariaDB database server
- Composer (for PHP dependencies)

## ğŸ—„ï¸ Database Setup

### 1. Create/Update Database Schema

Run the updated SQL schema from `src/database/lotus_shrine_updated.sql` in your MySQL database:

```sql
-- If you have an existing database, add the missing column:
ALTER TABLE `ko_na_win_tracker` ADD COLUMN `current_stage` int(11) NOT NULL DEFAULT 1 AFTER `current_day_count`;
```

### 2. Database Tables Structure

The system uses two main tables:

#### `ko_na_win_tracker` Table
- `tracker_id` (INT, Primary Key) - Unique identifier for each vow
- `user_id` (INT, Foreign Key) - Links to users table
- `start_date` (DATE) - When the vow started
- `current_day_count` (INT) - Total days completed (1-81)
- `current_stage` (INT) - Current 9-day stage (1-9)
- `is_completed` (BOOLEAN) - Whether the 81-day vow is complete

#### `ko_na_win_daily_log` Table
- `log_id` (INT, Primary Key) - Unique identifier for each log entry
- `tracker_id` (INT, Foreign Key) - Links to ko_na_win_tracker
- `log_date` (DATE) - Date of the log entry
- `day_number` (INT) - Day number within current stage (1-9)
- `completion_status` (BOOLEAN) - Whether the day was completed

## ğŸ“ File Structure

Copy these files to your `http://localhost/lotus_shrine/` directory:

```
lotus_shrine/
â”œâ”€â”€ checkKoNaWinTracker.php
â”œâ”€â”€ newKNWTracker.php
â”œâ”€â”€ logDailyCompletion.php
â”œâ”€â”€ getKoeNaWinProgress.php
â”œâ”€â”€ Libs/
â”‚   â””â”€â”€ Database/
â”‚       â”œâ”€â”€ MySQL.php
â”‚       â””â”€â”€ KoNaWinTable.php
â””â”€â”€ vendor/ (generated by composer)
```

## ğŸ”§ Configuration

### 1. Database Connection

Update `Libs/Database/MySQL.php` with your database credentials:

```php
public function __construct(
    $dbhost = "localhost",
    $dbuser = "your_username", 
    $dbpass = "your_password", 
    $dbname = "lotus_shrine"
)
```

### 2. CORS Configuration

All PHP files include CORS headers for `http://localhost:5173`. If your frontend runs on a different port, update the headers:

```php
header("Access-Control-Allow-Origin: http://localhost:5173");
```

### 3. Composer Dependencies

Install PHP dependencies:

```bash
cd /path/to/lotus_shrine
composer install
```

## ğŸš€ API Endpoints

### 1. Check Koe Na Win Tracker
- **Endpoint**: `POST /checkKoNaWinTracker.php`
- **Body**: `{"userId": "user_id"}`
- **Response**: Returns whether user has an active vow

### 2. Start New Vow
- **Endpoint**: `POST /newKNWTracker.php`
- **Body**: `{"userId": "user_id", "startDate": "YYYY-MM-DD"}`
- **Response**: Creates new vow and returns tracker details

### 3. Log Daily Completion
- **Endpoint**: `POST /logDailyCompletion.php`
- **Body**: `{"trackerId": "tracker_id", "dayNumber": "day_number", "userId": "user_id"}`
- **Response**: Logs completion and updates progress

### 4. Get Progress
- **Endpoint**: `POST /getKoeNaWinProgress.php`
- **Body**: `{"userId": "user_id"}`
- **Response**: Returns comprehensive progress data

## ğŸ”„ Frontend Integration

### 1. API Service

The React frontend uses `src/data/koenawinApi.ts` which provides:

```typescript
// Check if user has active vow
const response = await koNaWinApi.checkKoNaWinTracker();

// Start new vow
const response = await koNaWinApi.startNewVow();

// Log daily completion
const response = await koNaWinApi.logDailyCompletion(trackerId, dayNumber);

// Get progress
const progress = await koNaWinApi.getKoeNaWinProgress();
```

### 2. Updated React Component

The `src/pages/koenawin.tsx` component has been updated to use the new API service instead of direct axios calls.

## ğŸ§ª Testing

### 1. Test Database Connection

Create a simple test file `test_db.php`:

```php
<?php
require_once 'Libs/Database/MySQL.php';
use Libs\Database\MySQL;

$mysql = new MySQL();
$connection = $mysql->connect();
if ($connection) {
    echo "Database connection successful!";
} else {
    echo "Database connection failed!";
}
?>
```

### 2. Test API Endpoints

Use Postman or curl to test endpoints:

```bash
# Test check tracker
curl -X POST http://localhost/lotus_shrine/checkKoNaWinTracker.php \
  -H "Content-Type: application/json" \
  -d '{"userId": "1"}'

# Test start new vow
curl -X POST http://localhost/lotus_shrine/newKNWTracker.php \
  -H "Content-Type: application/json" \
  -d '{"userId": "1", "startDate": "2025-01-01"}'
```

## ğŸ” Troubleshooting

### Common Issues

1. **CORS Errors**: Ensure CORS headers match your frontend URL
2. **Database Connection**: Verify database credentials and server status
3. **Missing current_stage Column**: Run the ALTER TABLE statement
4. **Composer Dependencies**: Run `composer install` in the backend directory

### Debug Mode

Enable error reporting in PHP files for debugging:

```php
error_reporting(E_ALL);
ini_set('display_errors', 1);
```

## ğŸ“Š Koe Na Win Logic

### Stage Calculation
- **Stage 1**: Days 1-9
- **Stage 2**: Days 10-18
- **Stage 3**: Days 19-27
- ...and so on up to **Stage 9**: Days 73-81

### Day Number Calculation
Within each stage, day numbers reset to 1-9:
- Day 1 of Stage 1 = Day 1
- Day 10 of total = Day 1 of Stage 2
- Day 19 of total = Day 1 of Stage 3

### Mantras by Stage
Each stage has a specific mantra:
1. á€¡á€›á€Ÿá€¶
2. á€á€™á€¹á€™á€¬á€á€™á€¹á€—á€¯á€’á€¹á€“á€±á€«
3. á€á€­á€‡á€¹á€‡á€¬á€…á€›á€á€á€™á€¹á€•á€”á€¹á€”á€±á€¬
4. á€á€¯á€‚á€á€±á€¬
5. á€œá€±á€¬á€€á€á€­á€’á€°
6. á€¡á€”á€¯á€á€¹á€á€›á€±á€¬ á€•á€¯á€›á€­á€á€’á€™á€¹á€™á€á€¬á€›á€‘á€­
7. á€á€á€¹á€‘á€¬ á€’á€±á€á€™á€”á€¯á€¿á€¬á€”á€¶
8. á€—á€¯á€’á€¹á€“á€±á€«
9. á€˜á€‚á€á€«

## ğŸ¯ Next Steps

1. Copy the PHP files to your `http://localhost/lotus_shrine/` directory
2. Update database credentials in `MySQL.php`
3. Run the database schema updates
4. Test the API endpoints
5. Update your frontend to use the new API service
6. Test the complete flow from frontend to backend

## ğŸ“ Support

If you encounter issues:
1. Check the browser console for JavaScript errors
2. Check the PHP error logs
3. Verify database connectivity
4. Ensure all file permissions are correct
